<div #readerContainer class="reader-container">

  <div *ngIf="isLoading" class="loading-indicator">Loading book...</div>
  <div *ngIf="errorMessage && !isLoading" class="error-message">{{ errorMessage }}</div>

  <div #readerContentWrapper
       class="reader-content-wrapper"
       [class.scrolling-mode-active]="scrollingMode"
       (wheel)="onWheelScroll($event)"
       (touchstart)="onTouchStart($event)"
       (touchmove)="onTouchMove($event)"
       (touchend)="onTouchEnd($event)"
       (touchcancel)="onTouchCancel($event)">
    <!-- Content is dynamically set based on mode -->
    <div #readerContent class="reader-content" [innerHTML]="text"></div>
  </div>

  <div #paginationControls *ngIf="!isLoading && !errorMessage" class="pagination-controls">

    <!-- Buttons are always enabled in scroll mode unless at absolute start/end -->
    <app-button
      appearance="text"
      [disabled]="!scrollingMode && currentPage <= 1 || scrollingMode && topVisibleLineIndex <= 0"
      (clickFunction)="prevPage()"
    >
      <lucide-icon
        name="circle-chevron-left"
        class="prev-button"
        size="28"
        strokeWidth="1.5"
      ></lucide-icon>
    </app-button>

    <div class="pagination-center-area">
      <span class="pagination-info">
          <!-- Show page number consistently -->
          Page {{ currentPage }} of {{ totalPages }}
        <!-- Optionally show line index in scroll mode for debugging -->
        <!-- <span *ngIf="scrollingMode"> (Line: {{ topVisibleLineIndex }})</span> -->
      </span>
      <!-- Slider reflects currentPage, which is calculated differently in each mode -->
      <input type="range" class="page-slider"
             [min]="1"
             [max]="totalPages"
             [ngModel]="currentPage"
             (input)="onSliderInput($event)"
             (change)="onSliderChange($event)"
             [disabled]="totalPages <= 1"
             aria-label="Page Slider"/>
    </div>

    <button type="button" (click)="toggleScrollMode()" class="pagination-button next-button">
      {{ scrollingMode ? 'Disable Scrolling' : 'Enable Scrolling' }}
    </button>

    <app-button
      appearance="text"
      [disabled]="!scrollingMode && currentPage >= totalPages || scrollingMode && topVisibleLineIndex >= (lines.length - 1)"
      (clickFunction)="nextPage()"
    >
      <lucide-icon
        name="circle-chevron-right"
        class="next-button"
        size="28"
        strokeWidth="1.5"
      ></lucide-icon>
    </app-button>
  </div>
</div>
