<div #readerContainer class="reader-container"
     (click)="onWrapperClick($event)"
     [class.scrolling-mode-active]="scrollingMode"
     (wheel)="onWheelScroll($event)"
     (touchstart)="onTouchStart($event)"
     (touchmove)="onTouchMove($event)"
     (touchend)="onTouchEnd($event)"
     (touchcancel)="onTouchCancel($event)"
>

  <div *ngIf="isLoading" class="loading-indicator">Loading book...</div>
  <div *ngIf="errorMessage && !isLoading" class="error-message">{{ errorMessage }}</div>

  <div #readerContentWrapper
       class="reader-content-wrapper">
    <!-- Content is dynamically set based on mode -->
    <div #readerContent class="reader-content" [innerHTML]="text"></div>
  </div>

  <div #paginationControls *ngIf="!isLoading && !errorMessage" class="pagination-controls">

    <!--    <lucide-icon-->
    <!--      name="circle-arrow-out-up-left"-->
    <!--      class="absolute left-2 bottom-2 cursor-pointer"-->
    <!--      size="28"-->
    <!--      strokeWidth="1.5"-->
    <!--      (click)="goBack()"-->
    <!--    ></lucide-icon>-->

    <div class="pagination-center-area">
      <app-button
        appearance="text"
        [disabled]="!scrollingMode && currentPage <= 1 || scrollingMode && topVisibleLineIndex <= 0"
        (mousedown)="startScrollHold('prev')"
        (touchstart)="startScrollHold('prev'); $event.preventDefault()"
        (mouseup)="stopScrollHold('prev')"
        (touchend)="stopScrollHold('prev')"
        (mouseleave)="clearScrollHoldTimers()"
        (touchcancel)="clearScrollHoldTimers()"
        title="Previous Page (Click) / Scroll Up (Hold)"
        aria-label="Previous Page (Click) / Scroll Up (Hold)"
      >
        <lucide-icon
          name="circle-chevron-left"
          class="prev-button"
          size="28"
          strokeWidth="1.5"
        ></lucide-icon>
      </app-button>

      <div>
        <input type="range"
               class="page-slider"
               tuiSlider
               [min]="1"
               [max]="totalPages"
               [ngModel]="currentPage"
               (input)="onSliderInput($event)"
               (change)="onSliderChange($event)"
               [disabled]="totalPages <= 1"
               aria-label="Page Slider"/>
        <span class="pagination-info">
            Page {{ currentPage }} of {{ totalPages }}</span>
      </div>
      <app-button
        appearance="text"
        [disabled]="!scrollingMode && currentPage >= totalPages || scrollingMode && topVisibleLineIndex >= (lines.length - 1)"
        (mousedown)="startScrollHold('next')"
        (touchstart)="startScrollHold('next'); $event.preventDefault()"
        (mouseup)="stopScrollHold('next')"
        (touchend)="stopScrollHold('next')"
        (mouseleave)="clearScrollHoldTimers()"
        (touchcancel)="clearScrollHoldTimers()"
        title="Next Page (Click) / Scroll Down (Hold)"
        aria-label="Next Page (Click) / Scroll Down (Hold)"
      >
        <lucide-icon
          name="circle-chevron-right"
          class="next-button"
          size="28"
          strokeWidth="1.5"
        ></lucide-icon>
      </app-button>

      @if (parallelVersions.length > 0) {
        <div class="parallel">
          <app-parallel-translation [inactive]="parallelInactive"></app-parallel-translation>
          <tui-select
            tuiTextfieldSize="s"
            class="language-select"
            [formControl]="languageSelectControl"
            [tuiTextfieldLabelOutside]="true"
          >
            <tui-data-list-wrapper
              *tuiDataList
              [items]="langs"
            >
            </tui-data-list-wrapper>
          </tui-select>
        </div>
      }
    </div>
    <!--    <button type="button" (click)="toggleScrollMode()" class="pagination-button next-button">-->
    <!--      {{ scrollingMode ? 'Disable Scrolling' : 'Enable Scrolling' }}-->
    <!--    </button>-->
  </div>
</div>
